<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Appeals Portal</title>
    <link id="themeStylesheet" href="/ban-light.css" rel="stylesheet" type="text/css" media="all">
    <style>
        .evidence-image {
            max-width: 600px;
            height: auto;
            max-height: 240px;
            display: flex;
            margin-top: 5px;
            max-width: 100%;
        }
        audio {
            width: 100%;
            max-width: 400px;
            display: block;
            margin-top: 8px;
        }
        .evidence-box {
            margin-top: 0px;
            padding: 12px;
            display: block;
            border-radius: 0px;
            max-width: 685px;
        }
        .inneritem {
            display: block;
            margin: 0px;
        }
        .viol {
            margin: 0px;
        }
        #evidenceheading {
            margin: 0px;
            line-height: 1em;
            font-size: 18px;
        }
        #rulebreakitem {
            background-color: #fff;
            padding: 20px;
            display: block;
            max-width: 700px!important;
            max-width: 100%;
            border-radius: 8px;
        }
        button {
            margin: 0px;
            padding: 0px;
            display: inline-block;
        }
        .punishment-box {
            background-color: red;
            color: white;
            padding: 12px;
            border-radius: 8px;
            padding-left: 20px;
            padding-right: 25px;
            max-width: 800px;
            text-align: left;
            margin-bottom: 20px;
            display: block;
            font-family: 'Inter', ui-sans-serif;
            font-weight: bold;
            max-width: 100%;
        }
        .appeal-actions {
            margin-top: 20px;
        }
        .appeal-actions select, .appeal-actions textarea {
            width: 100%;
            margin-bottom: 10px;
        }
        .appeal-actions button {
            margin-right: 10px;
        }
    </style>
    <div id="header">
        <b id="username">Username</b>
    </div><br>
</head>
<body>
    <h3>Appeals Portal</h3>
    
    <!-- Punishment Box -->
    <div id="punishmentBox" class="punishment-box" style="display: none;"></div>

    <p>To request an appeal, send an email to <b>boibyappeals@gmail.com.</b><br>Tell us your username and a description of your appeal. Appeals will only be reviewed 60 days after the moderation action was applied.</p>
    <p>All activity must follow <a href="/community-rules.html">Boiby Community Rules</a>.</p><br>
    <h4 id="active">Active violations</h4>
    <div id="rulebreakitem">
        <h5 id="evidenceHeading"></h5>
        <div class="evidence-box" id="evidenceContainer"></div> 
        <div class="appeal-actions" id="appealActions" style="display: none;">
            <select id="appealDecision">
                <option value="accept">Accept Appeal</option>
                <option value="reject">Reject Appeal</option>
            </select>
            <select id="newReason" style="display: none;">
                <option value="">-- Select a Reason --</option>
                <option value="Other">Other</option>
                <option value="Harassment">Harassment</option>
                <option value="Inappropriate">Inappropriate</option>
                <option value="Privacy">Privacy</option>
                <option value="Adult Content">Adult Content</option>
                <option value="Sexual Content">Sexual Content</option>
                <option value="Misusing Boiby Systems">Misusing Boiby Systems</option>
                <option value="Terrorism/Extremism">Terrorism/Extremism</option>
                <option value="Political Content">Political Content</option>
                <option value="Boiby Endangerment">Boiby Endangerment</option>
                <option value="Discriminatory Content">Discriminatory Content</option>
                <option value="Violent Content and Gore">Violent Content and Gore</option>
                <option value="Privacy: Sharing PII">Privacy: Sharing PII</option>
                <option value="Privacy: Asking for PII">Privacy: Asking for PII</option>
                <option value="Doxxing">Doxxing</option>
                <option value="Seeking Sexual Content">Seeking Sexual Content</option>
                <option value="Intellectual Property Violation">IP Violation</option>
                <option value="Scamming">Scamming</option>
                <option value="Misinformation">Misinformation</option>
                <option value="Abuse of Boiby Employees">Abuse of Boiby Employees</option>
                <option value="Profanity">Profanity</option>
                <option value="Illegal and Regulated Content">Illegal and Regulated Content</option>
                <option value="Boiby Economy">Boiby Economy</option>
                <option value="Cheats and Exploits">Cheats and Exploits</option>
                <option value="Spam">Spam</option>
                <option value="Extortion and Blackmail">Extortion and Blackmail</option>
                <option value="Directing Users Off-Platform">Directing Users Off-Platform</option>
                <option value="Contests and Sweepstakes">Contests and Sweepstakes</option>
                <option value="Gambling Content">Gambling Content</option>
                <option value="Real-Life Threats">Real-Life Threats</option>
                <option value="Real-World Tragic Events">Real-World Tragedy</option>
                <option value="Impersonation">Impersonation</option>
                <option value="Dangerous Activities">Dangerous Activities</option>
                <option value="Disruptive Audio">Disruptive Audio</option>
                <option value="Dating and Romantic Content">Dating and Romantic Content</option>
                <option value="Malicious Software">Malicious Software</option>
            </select>
            <button id="submitAppealDecision">Submit</button>
        </div>
        <button id="requestAppeal">Request Appeal</button>
        <button class="logout"><a href="/not-approved" class="logoutlink">Back</a></button>
    </div>
    <script>
    const formData = JSON.parse(localStorage.getItem('banFormData'));
    const evidenceContainer = document.getElementById('evidenceContainer');
    const punishmentBox = document.getElementById('punishmentBox');
    const evidenceHeading = document.getElementById('evidenceHeading');
    const appealActions = document.getElementById('appealActions');
    const requestAppealButton = document.getElementById('requestAppeal');
    const appealDecision = document.getElementById('appealDecision');
    const newReason = document.getElementById('newReason');
    const submitAppealDecision = document.getElementById('submitAppealDecision');

    // Map punishment states to display text
    const punishmentMap = {
        Ban1Day: "Your account is currently banned for 1 day.",
        Ban3Days: "Your account is currently banned for 3 days.",
        Ban7Days: "Your account is currently banned for 7 days.",
        Ban14Days: "Your account is currently banned for 14 days.",
        Delete: "Your account has been permanently banned.",
        Poison: "Your account has been permanently banned, and account creation is permanently suspended."
    };

    // Show punishment box if applicable
    if (formData && formData.state && punishmentMap[formData.state]) {
        punishmentBox.textContent = punishmentMap[formData.state];
        punishmentBox.style.display = "inline-block";
    }

    // Display evidence items
    if (formData && formData.classicViolations && formData.classicViolations.length > 0) {
        formData.classicViolations.forEach((violation, index) => {
            const violationDetails = document.createElement('div');
            violationDetails.classList.add('violation-section');
            violationDetails.style.display = 'inline-block';
            violationDetails.style.marginRight = '10px';

            // Add Violation Type Heading
            let violationTypeText = '';
            if (violation.violationType === "General/Chat") {
                violationTypeText = "You violated our rules.";
            } else if (violation.violationType === "Model") {
                violationTypeText = "Model removed.";
            } else {
                violationTypeText = `Your ${violation.violationType} broke the rules.`;
            }
            evidenceHeading.textContent = violationTypeText;

            // Add Reason
            const reasonElement = document.createElement('p');
            reasonElement.innerHTML = `Violation: <b>${violation.reason}</b>`;
            violationDetails.appendChild(reasonElement);

            // Add Evidence
            const evidenceElement = document.createElement('p');
            if (violation.violationType === "Image") {
                evidenceElement.innerHTML = `Evidence: <b>Asset ID:${Math.floor(100000000000 + Math.random() * 900000000000)}</b>`;
                const imgElement = document.createElement('img');
                imgElement.src = violation.evidence; // Use base64 data as src
                imgElement.classList.add('evidence-image');
                evidenceElement.appendChild(imgElement);
            } else if (violation.violationType === "Voice Chat") {
                const date = new Date();
                date.setMinutes(date.getMinutes() - 5);
                const formattedDate = date.toLocaleString('en-US', { month: 'long', day: 'numeric', hour: '2-digit', minute: '2-digit', hour12: false });
                evidenceElement.innerHTML = `Evidence: <b>Voice chat conversation on ${formattedDate} at ${violation.evidence}</b>`;
            } else if (violation.violationType === "Game") {
                evidenceElement.innerHTML = `Evidence: <b>Game Name: ${violation.evidence}; Game ID: ${Math.floor(100000000000 + Math.random() * 900000000000)}</b>`;
            } else if (violation.violationType === "Group Shout") {
                evidenceElement.innerHTML = `Evidence: <b>Group ID: ${Math.floor(100000 + Math.random() * 900000)}; Group Shout: ${violation.evidence}</b>`;
            } else if (violation.violationType === "Group Description") {
                evidenceElement.innerHTML = `Evidence: <b>Group ID: ${Math.floor(100000 + Math.random() * 900000)}; Group Description: ${violation.evidence}</b>`;
            } else if (violation.violationType === "Group Roleset") {
                evidenceElement.innerHTML = `Evidence: <b>Group ID: ${Math.floor(100000 + Math.random() * 900000)}; Group Roleset Name: ${violation.evidence}</b>`;
            } else if (violation.violationType === "UGC Bundle") {
                evidenceElement.innerHTML = `Evidence: <b>UGC Bundle Name: ${violation.evidence}; Bundle ID: ${Math.floor(100000000000 + Math.random() * 900000000000)}</b>`;
            } else if (violation.violationType === "UGC Accessory") {
                evidenceElement.innerHTML = `Evidence: <b>UGC Accessory Name: ${violation.evidence}; Accessory ID: ${Math.floor(100000000000 + Math.random() * 900000000000)}</b>`;
            } else if (violation.violationType === "Asset") {
                evidenceElement.innerHTML = `Evidence: <b>Asset Name: ${violation.evidence} Asset ID: ${Math.floor(100000000000 + Math.random() * 900000000000)}</b>`;
            } else if (violation.violationType === "Audio") {
                evidenceElement.innerHTML = `Evidence: <b>Asset ID: ${Math.floor(100000000000 + Math.random() * 900000000000)}</b>`;
                const audioElement = document.createElement('audio');
                audioElement.controls = true;
                audioElement.src = violation.evidence; // Use base64 data as src
                evidenceElement.appendChild(audioElement);
            } else if (violation.violationType === "User Profile About") {
                evidenceElement.innerHTML = `Evidence: <b>User Profile About: ${violation.evidence}</b>`;
            } else if (violation.violationType === "Group Wall Post") {
                evidenceElement.innerHTML = `Evidence: <b>Group ID: 1; Group Wall Post: ${violation.evidence}</b>`;
            } else if (violation.violationType === "Username") {
                evidenceElement.innerHTML = `Evidence: <b>Username: ${violation.evidence}</b>`;
            } else if (violation.violationType === "Display Name") {
                evidenceElement.innerHTML = `Evidence: <b>Display Name: ${violation.evidence}</b>`;
            } else if (violation.violationType === "Web Chat") {
                evidenceElement.innerHTML = `Evidence: <b>Web Chat: ${violation.evidence}</b>`;
            } else {
                evidenceElement.innerHTML = `Evidence: <b>${violation.evidence}</b>`;
            }
            violationDetails.appendChild(evidenceElement);

            // Append to evidenceContainer
            evidenceContainer.appendChild(violationDetails);
        });
    }

    // Load saved username from localStorage
    const savedUsername = localStorage.getItem('username');
    if (savedUsername) {
        document.getElementById('username').textContent = savedUsername;
    }

    // Request Appeal Button
    requestAppealButton.addEventListener('click', () => {
        appealActions.style.display = 'block';
    });

    // Appeal Decision Logic
    appealDecision.addEventListener('change', (e) => {
        if (e.target.value === 'reject') {
            newReason.style.display = 'block';
        } else {
            newReason.style.display = 'none';
        }
    });

    submitAppealDecision.addEventListener('click', () => {
        const decision = appealDecision.value;
        if (decision === 'accept') {
            alert('Appeal accepted. The ban will be lifted.');
            // Logic to lift the ban (e.g., update localStorage and redirect)
        } else if (decision === 'reject') {
            const selectedReason = newReason.value;
            if (!selectedReason) {
                alert('Please select a reason for rejection.');
                return;
            }

            // Update the ban data
            formData.classicViolations[0].reason = selectedReason; // Update the first violation's reason
            if (selectedReason === "Boiby Endangerment") {
                formData.state = "Delete"; // Change ban state to Delete
                formData.note = ""; // Wipe moderator note
            }

            // Save updated data to localStorage
            localStorage.setItem('banFormData', JSON.stringify(formData));

            // Add a new punishment box
            const newPunishmentBox = document.createElement('div');
            newPunishmentBox.className = 'punishment-box';
            newPunishmentBox.textContent = `Violation Changed: ${selectedReason}`;
            punishmentBox.insertAdjacentElement('afterend', newPunishmentBox);

            // Reload the page to reflect changes
            window.location.reload();
        }
    });
    </script>
</body>
</html>
