<!doctype html>
<html lang="en">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>User Profile</title>
<style>
/* Import fonts */
@import url('https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap');

:root{
  --color-bg:#f3f3f3;
  --color-box-bg:#ffffff;
  --color-text:#111;
  --font-family:"Inter",sans-serif;
  --fw-light:300; --fw-regular:400; --fw-medium:550; --fw-semibold:600;
  --fs-small:14px; --fs-base:16px; --fs-heading:22px;
  --line-height:1.35em;
}

body{
  background:var(--color-bg);
  font-family:var(--font-family);
  margin:0;
  padding:30px 0;
  line-height:var(--line-height);
}

.profile-container { width:900px; margin:auto; }

/* Card */
.card { background:var(--color-box-bg); padding:20px; margin-bottom:20px; }

/* Header */
.profile-header { display:flex; align-items:center; gap:15px; }
#profile-pic { width:100px; height:100px; border-radius:100%; object-fit:cover; }
.profile-info h2 { margin:0; font-size:var(--fs-heading); font-weight:var(--fw-medium); color:var(--color-text); }
.profile-info p { margin:2px 0 6px; font-size:var(--fs-base); font-weight:var(--fw-light); color:var(--color-text); }
.profile-stats { margin-top:5px; font-size:var(--fs-small); color:var(--color-text); }

/* Tabs removed for simplicity (you can keep them if you like) */

/* Sections */
.section h3 { font-size:var(--fs-base); font-weight:var(--fw-semibold); margin-bottom:10px; }
.section p { font-size:var(--fs-small); }

/* Friends */
.friends-list { display:flex; gap:16px; flex-wrap:wrap; margin-top:10px; }
.friend { width:128px; text-align:center; }
.friend img { width:128px; height:128px; border-radius:6px; object-fit:cover; display:block; margin:0 auto; }
.friend p { font-size:var(--fs-small); margin:6px 0 0; }

/* small helper for clickable images */
.friend a { color:inherit; text-decoration:none; display:block; }
</style>
</head>
<body>

<div class="profile-container">
  <!-- Header Card -->
  <div class="card profile-header">
    <img id="profile-pic" src="placeholder.png" alt="Avatar">
    <div class="profile-info">
      <h2 id="username">Loading…</h2>
      <div class="profile-stats" id="user-tag">@username</div>
      <div class="profile-stats" id="user-stats">0 Friends · 0 Followers · 0 Following</div>
    </div>
  </div>

  <!-- About -->
  <div class="card">
    <div class="section">
      <h3>About</h3>
      <p id="about-alias">Alias: —</p>
    </div>
  </div>

  <!-- Friends -->
  <div id="friends-card" class="card">
    <div class="section">
      <h3 id="friends-title">Friends (0)</h3>
      <div id="friends-list" class="friends-list"></div>
    </div>
  </div>

  <!-- Statistics / Join date -->
  <div class="card">
    <div class="section">
      <h3>Statistics</h3>
      <p>Join Date: <span id="join-date">—</span></p>
    </div>
  </div>
</div>

<script>
/*
  Behavior:
  - Grab user id from filename e.g. 1.html -> "1"
  - Fetch users.json next to this file
  - On fetch error -> redirect to error-500.html
  - If user id not present -> redirect to error-404.html
  - If isDeleted true -> redirect to userDeleted.html
  - Populate the profile page; build friends list as clickable links to "<id>.html"
*/

(function(){
  const redirect500 = () => { window.location.href = 'error-500.html'; };
  const redirect404 = () => { window.location.href = 'error-404.html'; };
  const redirectDeleted = () => { window.location.href = 'userDeleted.html'; };

  // get user id from filename (assumes pages like "1.html", "2.html")
  function getUserIdFromPath(){
    try{
      const path = window.location.pathname;
      const file = path.substring(path.lastIndexOf('/')+1) || '';
      const name = file.split('?')[0].split('#')[0];
      const id = name.split('.').slice(0, -1).join('.');
      // fallback: if name has no extension, treat the whole as id
      const candidate = id || name;
      if(!candidate || !/^\d+$/.test(candidate)) return null;
      return candidate;
    } catch(e) {
      return null;
    }
  }

  const userId = getUserIdFromPath();
  if(!userId) return redirect404();

  fetch('users.json', {cache: 'no-store'}).then(resp=>{
    if(!resp.ok) throw new Error('fetch-failed');
    return resp.json();
  }).then(data=>{
    // data expected to be object keyed by id strings
    if(!data || typeof data !== 'object') throw new Error('invalid-json');

    const user = data[userId];
    if(!user) return redirect404();
    if(user.isDeleted) return redirectDeleted();

    // populate basic fields
    const profilePic = document.getElementById('profile-pic');
    const usernameEl = document.getElementById('username');
    const tagEl = document.getElementById('user-tag');
    const statsEl = document.getElementById('user-stats');
    const aboutAlias = document.getElementById('about-alias');
    const joinDateEl = document.getElementById('join-date');
    const friendsListEl = document.getElementById('friends-list');
    const friendsTitle = document.getElementById('friends-title');
    const friendsCard = document.getElementById('friends-card');

    // set values (with safe fallbacks)
    profilePic.src = user.profilePicture || 'placeholder.png';
    profilePic.alt = (user.username || 'User') + ' avatar';
    usernameEl.textContent = user.username || 'Unknown';
    tagEl.textContent = '@' + (user.username || 'unknown');
    const friendsCount = Array.isArray(user.friends) ? user.friends.length : 0;
    const followers = Number(user.followers || 0);
    const following = Number(user.following || 0);
    statsEl.textContent = `${friendsCount} Friends · ${followers} Followers · ${following} Following`;
    aboutAlias.textContent = 'Alias: ' + (user.alias || '✶');
    joinDateEl.textContent = user.joinDate || '—';

    // build friends
    friendsListEl.innerHTML = '';
    if(!Array.isArray(user.friends) || user.friends.length === 0){
      // If you prefer to hide the entire friends card when empty:
      // friendsCard.style.display = 'none';
      friendsTitle.textContent = 'Friends (0)';
    } else {
      friendsTitle.textContent = `Friends (${friendsCount})`;
      user.friends.forEach(fid => {
        const friendData = data[String(fid)];
        // Only show friend if there is user data for them. If not found, skip.
        if(!friendData) return;
        // create friend block
        const a = document.createElement('a');
        a.href = `${fid}.html`;
        a.className = 'friend';
        // inner HTML structure
        a.innerHTML = `
          <img src="${friendData.profilePicture || 'placeholder.png'}" alt="${friendData.username || 'User'}">
          <p>${friendData.username || 'User'}</p>
        `;
        // handle image load failures: replace with placeholder
        const img = a.querySelector('img');
        img.onerror = function(){ this.onerror = null; this.src = 'placeholder.png'; };

        friendsListEl.appendChild(a);
      });
    }
  }).catch(err=>{
    console.error('User fetch/build error:', err);
    redirect500();
  });
})();
</script>

</body>
</html>
